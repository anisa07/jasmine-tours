---
import IntlBaseLayout from "@/layouts/IntlBaseLayout.astro";
import { getPageTranslations, getLocaleStaticPaths } from "@/i18n/i18n";
import type { Locale } from "@/i18n/config";

// Layout components
import Container from "@/components/layout/Container.astro";
import { Image } from "astro:assets";

// Icons
import {
  MessageCircle,
  Instagram,
  MapPin,
  Clock,
  Users,
  Star,
  Calendar,
  CheckCircle,
  Camera,
  Utensils,
  Bed,
  Shield,
  ArrowLeft,
} from "@lucide/astro";

// Generate static paths for all supported locales and tours
export async function getStaticPaths() {
  const localeStaticPaths = getLocaleStaticPaths();

  // Define available tours
  const tours = [
    "labuan-bajo-adventure",
    "komodo-island-expedition",
    "jakarta-cultural-tour",
    "bali-temple-hopping",
    "yogyakarta-heritage",
    "raja-ampat-diving",
  ];

  // Generate paths for each locale and tour combination
  const paths = [];
  for (const localePath of localeStaticPaths) {
    for (const tour of tours) {
      paths.push({
        params: {
          locale: localePath.params.locale,
          tour: tour,
        },
      });
    }
  }

  return paths;
}

// Get locale and tour from dynamic route params
const { locale, tour } = Astro.params;

// Get the translation function for this page
const { t } = await getPageTranslations(locale as Locale, [
  "common",
  "ui",
  "home",
]);

// Tour data - in a real app, this would come from a CMS or database
const tourData = {
  "labuan-bajo-adventure": {
    title: "Labuan Bajo Adventure",
    subtitle: "Discover the Gateway to Komodo",
    price: 1250,
    duration: "4 Days / 3 Nights",
    groupSize: "2-8 People",
    rating: 4.9,
    reviewCount: 127,
    mainImage: "/assets/tour1.jpg",
    gallery: [
      "/assets/tour1.jpg",
      "/assets/tour2.jpg",
      "/assets/boat1.jpg",
      "/assets/island1.jpg",
    ],
    description:
      "Embark on an unforgettable journey to Labuan Bajo, the gateway to the legendary Komodo National Park. This adventure combines stunning landscapes, diverse marine life, and the iconic Komodo dragons.",
    highlights: [
      "Visit Komodo National Park and see dragons",
      "Snorkeling at Pink Beach",
      "Sunset cruise around Padar Island",
      "Traditional village experience",
      "Professional local guide",
      "All meals and accommodation included",
    ],
    itinerary: [
      {
        day: 1,
        title: "Arrival in Labuan Bajo",
        activities: [
          "Airport pickup",
          "Hotel check-in",
          "Welcome dinner",
          "Sunset at Mirror Stone Cave",
        ],
      },
      {
        day: 2,
        title: "Komodo National Park",
        activities: [
          "Early morning boat departure",
          "Komodo dragon tracking",
          "Lunch on boat",
          "Pink Beach snorkeling",
        ],
      },
      {
        day: 3,
        title: "Padar Island & Kanawa",
        activities: [
          "Sunrise hike at Padar Island",
          "Swimming at Kanawa Island",
          "Traditional lunch",
          "Sunset cruise",
        ],
      },
      {
        day: 4,
        title: "Cultural Experience & Departure",
        activities: [
          "Visit traditional market",
          "Local village tour",
          "Souvenir shopping",
          "Airport transfer",
        ],
      },
    ],
    included: [
      "Accommodation (3 nights)",
      "All meals",
      "Boat transportation",
      "Professional guide",
      "Park entrance fees",
      "Snorkeling equipment",
    ],
    notIncluded: [
      "International flights",
      "Personal expenses",
      "Travel insurance",
      "Tips for guide",
    ],
  },
  "komodo-island-expedition": {
    title: "Komodo Island Expedition",
    subtitle: "Meet the Last Dragons on Earth",
    price: 890,
    duration: "3 Days / 2 Nights",
    groupSize: "4-10 People",
    rating: 4.8,
    reviewCount: 89,
    mainImage: "/assets/tour4.jpeg",
    gallery: [
      "/assets/tour4.jpeg",
      "/assets/tour1.jpg",
      "/assets/snorkel1.jpg",
      "/assets/boat1.jpg",
    ],
    description:
      "A focused expedition to encounter the legendary Komodo dragons in their natural habitat. Perfect for wildlife enthusiasts and adventure seekers.",
    highlights: [
      "Close encounters with Komodo dragons",
      "Expert naturalist guide",
      "Pristine diving spots",
      "Remote island camping",
      "Traditional fishing experience",
      "Sunset photography sessions",
    ],
    itinerary: [
      {
        day: 1,
        title: "Journey to Komodo",
        activities: [
          "Morning departure from Labuan Bajo",
          "Komodo Island landing",
          "Dragon tracking expedition",
          "Beachside camp setup",
        ],
      },
      {
        day: 2,
        title: "Marine Exploration",
        activities: [
          "Early morning dive/snorkel",
          "Underwater photography",
          "Beach BBQ lunch",
          "Traditional fishing with locals",
        ],
      },
      {
        day: 3,
        title: "Final Adventure",
        activities: [
          "Sunrise photography",
          "Last dragon encounter",
          "Return journey",
          "Farewell lunch in Labuan Bajo",
        ],
      },
    ],
    included: [
      "Camping accommodation",
      "All meals",
      "Boat charter",
      "Diving/snorkeling gear",
      "Professional guide",
      "Photography tips",
    ],
    notIncluded: [
      "Hotel in Labuan Bajo",
      "Alcoholic beverages",
      "Personal diving gear",
      "Gratuities",
    ],
  },
  // Add more tours as needed
};

// Get current tour data or default
const currentTour =
  tourData[tour as keyof typeof tourData] || tourData["labuan-bajo-adventure"];

// WhatsApp booking function
const whatsappMessage = `Hi Jasmine! I'm interested in booking the "${currentTour.title}" tour. Can you provide more details and availability?`;
const whatsappUrl = `https://wa.me/1234567890?text=${encodeURIComponent(whatsappMessage)}`;
---

<IntlBaseLayout
  locale={locale}
  pageNS={["common", "ui", "home"]}
  seo={{
    title: `${currentTour.title} - ${currentTour.duration} | Jasmine Tours`,
    description: currentTour.description,
  }}
>
  <!-- Breadcrumb Navigation -->
  <!-- <section class="bg-muted/30 py-4 ">
    <Container>
      <div class="flex items-center gap-2 text-sm">
        <a
          href={`/${locale}`}
          class="text-muted-foreground hover:text-foreground">Home</a
        >
        <span class="text-muted-foreground">•</span>
        <a
          href={`/${locale}/tours`}
          class="text-muted-foreground hover:text-foreground">Tours</a
        >
        <span class="text-muted-foreground">•</span>
        <span class="text-foreground font-medium">{currentTour.title}</span>
      </div>
    </Container>
  </section> -->

  <!-- Hero Section with Image Gallery -->
  <section class="pb-8 pt-24">
    <Container size="lg">
      <!-- Back Button -->
      <div class="mb-6">
        <a
          href={`/${locale}`}
          class="inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors"
        >
          <ArrowLeft class="w-4 h-4" />
          Back to Tours
        </a>
      </div>

      <!-- Tour Title and Rating -->
      <div class="mb-8">
        <h1 class="text-4xl lg:text-5xl font-bold mb-2">{currentTour.title}</h1>
        <p class="text-xl text-muted-foreground mb-4">{currentTour.subtitle}</p>

        <div class="flex flex-wrap items-center gap-6 text-sm">
          <div class="flex items-center gap-2">
            <Star class="w-4 h-4 fill-warning text-warning" />
            <span class="font-semibold">{currentTour.rating}</span>
            <span class="text-muted-foreground"
              >({currentTour.reviewCount} reviews)</span
            >
          </div>
          <div class="flex items-center gap-2">
            <MapPin class="w-4 h-4 text-primary" />
            <span>Indonesia</span>
          </div>
          <div class="flex items-center gap-2">
            <Clock class="w-4 h-4 text-primary" />
            <span>{currentTour.duration}</span>
          </div>
          <div class="flex items-center gap-2">
            <Users class="w-4 h-4 text-primary" />
            <span>{currentTour.groupSize}</span>
          </div>
        </div>
      </div>

      <!-- Image Gallery -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-8">
        <!-- Main Image -->
        <div class="lg:col-span-2">
          <Image
            src={currentTour.mainImage}
            alt={currentTour.title}
            class="w-full h-96 lg:h-[500px] object-cover rounded-xl shadow-lg"
            width={800}
            height={500}
            format="webp"
            quality={85}
          />
        </div>

        <!-- Gallery Grid -->
        <div class="grid grid-cols-2 lg:grid-cols-1 gap-4">
          {
            currentTour.gallery
              .slice(1, 3)
              .map((image, index) => (
                <Image
                  src={image}
                  alt={`${currentTour.title} gallery ${index + 1}`}
                  class="w-full h-44 lg:h-[240px] object-cover rounded-xl shadow-md hover:shadow-lg transition-shadow"
                  width={400}
                  height={240}
                  format="webp"
                  quality={80}
                />
              ))
          }
        </div>
      </div>
    </Container>
  </section>

  <!-- Tour Details and Booking -->
  <section class="py-8">
    <Container size="lg">
      <div class="grid lg:grid-cols-3 gap-12">
        <!-- Tour Information -->
        <div class="lg:col-span-2 space-y-8">
          <!-- Description -->
          <div>
            <h2 class="text-2xl font-bold mb-4">About This Tour</h2>
            <p class="text-lg text-muted-foreground leading-relaxed">
              {currentTour.description}
            </p>
          </div>

          <!-- Highlights -->
          <div>
            <h3 class="text-xl font-semibold mb-4">Tour Highlights</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              {
                currentTour.highlights.map((highlight) => (
                  <div class="flex items-start gap-3">
                    <CheckCircle class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" />
                    <span class="text-muted-foreground">{highlight}</span>
                  </div>
                ))
              }
            </div>
          </div>

          <!-- Itinerary -->
          <div>
            <h3 class="text-xl font-semibold mb-6">Day by Day Itinerary</h3>
            <div class="space-y-6">
              {
                currentTour.itinerary.map((day) => (
                  <div class="border border-border rounded-lg p-6">
                    <h4 class="font-semibold text-lg mb-3">
                      <span class="text-primary">Day {day.day}:</span>{" "}
                      {day.title}
                    </h4>
                    <ul class="space-y-2">
                      {day.activities.map((activity) => (
                        <li class="flex items-start gap-2">
                          <div class="w-2 h-2 bg-primary rounded-full mt-2 flex-shrink-0" />
                          <span class="text-muted-foreground">{activity}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                ))
              }
            </div>
          </div>

          <!-- What's Included -->
          <div class="grid md:grid-cols-2 gap-8">
            <div>
              <h3 class="text-xl font-semibold mb-4 text-success">
                What's Included
              </h3>
              <ul class="space-y-2">
                {
                  currentTour.included.map((item) => (
                    <li class="flex items-start gap-2">
                      <CheckCircle class="w-4 h-4 text-success mt-1 flex-shrink-0" />
                      <span class="text-muted-foreground">{item}</span>
                    </li>
                  ))
                }
              </ul>
            </div>

            <div>
              <h3 class="text-xl font-semibold mb-4 text-destructive">
                Not Included
              </h3>
              <ul class="space-y-2">
                {
                  currentTour.notIncluded.map((item) => (
                    <li class="flex items-start gap-2">
                      <div class="w-4 h-4 border border-destructive rounded-full mt-1 flex-shrink-0" />
                      <span class="text-muted-foreground">{item}</span>
                    </li>
                  ))
                }
              </ul>
            </div>
          </div>
        </div>

        <!-- Booking Sidebar -->
        <div class="lg:col-span-1">
          <div class="sticky top-8">
            <div
              class="bg-background border border-border rounded-xl p-6 shadow-lg"
            >
              <!-- Price -->
              <div class="text-center mb-6">
                <div class="text-3xl font-bold text-primary mb-1">
                  ${currentTour.price.toLocaleString()}
                </div>
                <div class="text-sm text-muted-foreground">per person</div>
              </div>

              <!-- Quick Info -->
              <div class="space-y-4 mb-6">
                <div
                  class="flex items-center justify-between py-2 border-b border-border"
                >
                  <div class="flex items-center gap-2">
                    <Clock class="w-4 h-4 text-muted-foreground" />
                    <span class="text-sm">Duration</span>
                  </div>
                  <span class="text-sm font-medium">{currentTour.duration}</span
                  >
                </div>

                <div
                  class="flex items-center justify-between py-2 border-b border-border"
                >
                  <div class="flex items-center gap-2">
                    <Users class="w-4 h-4 text-muted-foreground" />
                    <span class="text-sm">Group Size</span>
                  </div>
                  <span class="text-sm font-medium"
                    >{currentTour.groupSize}</span
                  >
                </div>

                <div class="flex items-center justify-between py-2">
                  <div class="flex items-center gap-2">
                    <Star class="w-4 h-4 text-muted-foreground" />
                    <span class="text-sm">Rating</span>
                  </div>
                  <span class="text-sm font-medium">{currentTour.rating}/5</span
                  >
                </div>
              </div>

              <!-- Booking Button -->
              <a
                href={whatsappUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="w-full bg-primary text-primary-foreground hover:opacity-90 transition-opacity py-4 px-6 rounded-lg font-semibold text-center flex items-center justify-center gap-3 shadow-md hover:shadow-lg"
              >
                <MessageCircle class="w-5 h-5" />
                Book via WhatsApp
              </a>

              <!-- Contact Info -->
              <div class="mt-6 pt-6 border-t border-border text-center">
                <p class="text-sm text-muted-foreground mb-4">
                  Questions about this tour?
                </p>
                <a
                  href="https://instagram.com/jasmintours"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-2 text-primary hover:underline"
                >
                  <Instagram class="w-4 h-4" />
                  Follow on Instagram
                </a>
              </div>

              <!-- Safety Badge -->
              <div class="mt-6 pt-6 border-t border-border">
                <div
                  class="flex items-center gap-3 text-sm text-muted-foreground"
                >
                  <Shield class="w-5 h-5 text-success" />
                  <div>
                    <div class="font-medium text-foreground">
                      Safe & Certified
                    </div>
                    <div>Licensed tour operator</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </Container>
  </section>

  <!-- Related Tours -->
  <section class="py-20 bg-muted/30">
    <Container>
      <h2 class="text-3xl font-bold text-center mb-12">Other Amazing Tours</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {
          Object.entries(tourData)
            .filter(([key]) => key !== tour)
            .slice(0, 3)
            .map(([key, tourItem]) => (
              <a href={`/${locale}/tour/${key}`} class="group">
                <div class="bg-background rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-shadow">
                  <Image
                    src={tourItem.mainImage}
                    alt={tourItem.title}
                    class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
                    width={400}
                    height={192}
                    format="webp"
                    quality={80}
                  />
                  <div class="p-6">
                    <h3 class="font-semibold text-lg mb-2 group-hover:text-primary transition-colors">
                      {tourItem.title}
                    </h3>
                    <p class="text-muted-foreground text-sm mb-4 line-clamp-2">
                      {tourItem.description}
                    </p>
                    <div class="flex items-center justify-between">
                      <div class="text-lg font-bold text-primary">
                        ${tourItem.price.toLocaleString()}
                      </div>
                      <div class="text-sm text-muted-foreground">
                        {tourItem.duration}
                      </div>
                    </div>
                  </div>
                </div>
              </a>
            ))
        }
      </div>
    </Container>
  </section>
</IntlBaseLayout>
