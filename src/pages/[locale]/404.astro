---
// Locale-specific 404 page
import IntlBaseLayout from "@/layouts/IntlBaseLayout.astro";
import { getPageTranslations } from "@/i18n/i18n";
import type { Locale } from "@/i18n/config";
import { locales } from "@/i18n/config";
import NotFoundContent from "@/components/state/NotFoundContent.astro";

// Generate static paths for all supported locales
export async function getStaticPaths() {
  return locales.map((locale) => ({
    params: { locale },
  }));
}

// Get locale from dynamic route params
const { locale } = Astro.params;

// Get the translation function for this page
const { t } = await getPageTranslations(locale as Locale, ["common", "errors"]);

// Set 404 status
Astro.response.status = 404;

// Create alternates for hreflang
const alternates = Object.fromEntries(
  locales.map((loc) => [loc, `/${loc}/404`])
);
---

<IntlBaseLayout
  locale={locale}
  pageNS={["common", "errors"]}
  alternates={alternates}
  seo={{
    title: t("404.title", "Page Not Found"),
    description: t(
      "404.description",
      "The page you are looking for could not be found."
    ),
  }}
>
  <NotFoundContent
    locale={locale}
    homeHref={`/${locale}`}
    onBackClick="handleGoBack()"
  />
</IntlBaseLayout>

<script is:inline>
  // Enhanced back button functionality for localized 404
  window.handleGoBack = function () {
    // Check if there's history to go back to
    if (window.history.length > 1) {
      window.history.back();
    } else {
      // If no history, go to homepage - default to Russian if locale not found
      const currentLocale = window.location.pathname.split("/")[1] || "ru";
      window.location.href = `/${currentLocale}`;
    }
  };
</script>
