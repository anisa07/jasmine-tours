---
import IntlBaseLayout from "@/layouts/IntlBaseLayout.astro";
import { getPageTranslations, getLocaleStaticPaths } from "@/i18n/i18n";
import type { Locale } from "@/i18n/config";
import { getEntry } from "astro:content";

// Layout components
import Container from "@/components/layout/Container.astro";

// Icons
import { MessageCircle, Instagram, Facebook } from "@lucide/astro";

// Content components
import Hero from "@/components/content/Hero.astro";
import CallToAction from "@/components/content/CallToAction.astro";
import TourFilter from "@/components/content/TourFilter.astro";
import Testemonials from "@/components/content/Testemonials.astro";
import ImageGallery from "@/components/ImageGallery.astro";

// Generate static paths for all supported locales
export async function getStaticPaths() {
  return getLocaleStaticPaths();
}

// Get locale from dynamic route params
const { locale } = Astro.params;

// Get the translation function for this page
const { t } = await getPageTranslations(locale as Locale, [
  "common",
  "ui",
  "home",
]);

// Load content from CMS
const heroEntry = await getEntry("hero", "hero");
const heroData = heroEntry?.data;

const tourCategoriesEntry = await getEntry("tour-categories", "categories");
const tourCategoriesData = tourCategoriesEntry?.data?.categories || [];

const testimonialsEntry = await getEntry("testimonials", "testimonials");
const testimonialsData = testimonialsEntry?.data?.testimonials || [];

const galleryEntry = await getEntry("gallery", "gallery");
const galleryData = galleryEntry?.data?.images || [];

// Transform gallery data to match ImageGallery component expectations
const galleryImages = galleryData.map((image) => ({
  id: image.id,
  src: image.src,
  alt: t(`gallery_items.${image.id}.alt`, image.alt),
  title: t(`gallery_items.${image.id}.title`, image.title),
  description: t(`gallery_items.${image.id}.description`, image.description),
  thumbnail: image.thumbnail,
}));

const ctaActions = [
  {
    label: "Забронировать через WhatsApp",
    href: "https://wa.me/c/31642221525",
    variant: "primary" as const,
    size: "lg" as const,
    icon: MessageCircle,
  },
  {
    label: "Подписаться в Instagram",
    href: "https://www.instagram.com/jasmine.tours.amsterdam",
    variant: "outline" as const,
    size: "lg" as const,
    icon: Instagram,
  },
  {
    label: "Следить в Facebook",
    href: "https://www.facebook.com/jasmintoursevents/",
    variant: "outline" as const,
    size: "lg" as const,
    icon: Facebook,
  },
];
---

<IntlBaseLayout
  locale={locale}
  pageNS={["common", "ui", "home"]}
  seo={{
    title: t(
      "seo.title",
      "Jasmine Tours - Discover Amazing Travel Destinations | Book Your Adventure"
    ),
    description: t(
      "seo.description",
      "Explore breathtaking destinations with Jasmine Tours. Book your perfect adventure through WhatsApp or follow us on Instagram for travel inspiration."
    ),
  }}
>
  <!-- Hero Section -->
  <section class="relative">
    {
      heroData && (
        <Hero
          variant="split"
          subtitle={heroData.subtitle}
          title={heroData.title}
          description={heroData.description}
          images={heroData.images}
        />
      )
    }
  </section>

  <!-- Tour Filter Panel Section -->
  <section id="tours">
    <TourFilter t={t} tourCategories={tourCategoriesData} locale={locale} />
  </section>

  <!-- Testimonials Section -->
  <section id="testimonials">
    <Testemonials t={t} testimonials={testimonialsData} />
  </section>

  <!-- Gallery Section -->
  <section class="py-20 bg-muted/30">
    <Container size="xl" padding="lg">
      <div class="text-center mb-16 animate-fade-up">
        <h2 class="text-3xl md:text-4xl font-bold text-foreground mb-6">
          Мгновения из наших туров
        </h2>
        <p class="text-xl text-muted-foreground max-w-2xl mx-auto">
          Лучшие кадры, наполненные атмосферой Амстердама и путешествий по
          Нидерландам
        </p>
      </div>

      <div class="animate-fade-up animate-delay-1">
        <ImageGallery
          images={galleryData}
          columns={3}
          gap={24}
          showThumbnails={true}
          showCaption={true}
          showFullscreen={true}
          lazy={true}
          aspectRatio="landscape"
          className="mb-8"
        />
      </div>
    </Container>
  </section>

  <!-- CTA Section -->
  <section
    id="contact"
    class="bg-primary text-primary-foreground relative overflow-hidden"
  >
    <Container size="md" padding="xs" class="relative z-10">
      <CallToAction
        title="Готовы к новому приключению?"
        subtitle="Свяжитесь со мной, и я помогу спланировать ваше путешествие мечты"
        description="Напишите мне в WhatsApp для быстрой брони или загляните в мой Instagram — вдохновляйтесь идеями и атмосферой настоящей Голландии."
        actions={ctaActions}
        variant="default"
        backgroundColor="primary"
        class="animate-fade-up"
      />
    </Container>
  </section>
</IntlBaseLayout>
